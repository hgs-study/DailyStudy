## Kafka#2

### 프로듀서 파티셔너란?
---
```
  - 프로듀서가 데이터를 보내면 무조건 파티셔너를 통해서 브로커로 데이터가 전송되게 된다.
  - 파티셔너는 토픽의 어떤 파티션에 넣을지 결정하는 역할을 한다.
```

![image](https://user-images.githubusercontent.com/76584547/125187297-e072de80-e269-11eb-8652-237209fa72ac.png)

+ 레코드에 포함된 메시지 키 또는 메시지 값에 따라서 파티션의 위치가 결정된다.
+ 프로듀서를 사용할 때 파티셔너를 따로 설정하지 않으면 UniformStickyPartitioner로 설정된다.

```
  ㅇ UniformStickyPartitioner
    - 메시지 키가 있을 때와 없을 때 다르게 동작한다.
    - 메시지 키가 있는 경우 : 레코드는 파티셔너에 의해서 특정한 해쉬값이 생성된다. 이 해쉬값을 기준으로 어느 파티션에 들어갈지 정해진다.
      ※ 토픽에 파티션이 2개가 있는 경우,
        - 서울 - 파티션 0번
        - 부산 - 파티션 1번
        - 울산 - 파티션 0번
      => 동일한 메시지 키를 가진 레코드는 동일한 해쉬값을 만들어 내기 때문에 항상 동일한 파티션에 들어가는 것을 보장한다.
      => 동일한 해쉬값으로 동일한 파티션에 들어가기 때문에 순서를 지켜서 데이터를 처리할 수 있다는 장점이 있다.
        
    - 메시지 키가 없는 경우 : 메시지 키가 없는 경우 라운드 로빈으로 파티션에 들어가게 된다.\
      - 하지만 전통적인 라운드 로빈 방식과는 조금 다르게 동작한다.
      - UniformStickyPartitioner는 프로듀서에서 배치로 모을 수 있는 최대한의 레코드들을 모아서 파티션으로 데이터를 보내게 된다.
        (라운드 로빈 방식 사용)
      - 메시지 키가 없는 데이터들은 파티션에 적절히 분배된다고 생각하면 될 것
      
  ㅇ 커스텀 파티셔너
    - 카프카에서는 커스텀 파티셔너를 만들 수 있도록 Partitioner 인터페이스를 제공하고 있다.
    - 커스텀 파티셔너를 만들면 메시지 키, 메시지 값, 어느 토픽에 따라 데이터를 보낼 수 있을지 정할 수 있다.
    - 언제 사용할 수 있을까? (VIP 고객)
      총 파티션이 10개가 있다면 8개의 파티션은 VIP고객, 2개의 파티션은 일반 고객을 담당하여 VIP고객에 더 데이터 처리량을 몰아주는 형태
      (AMQP에서 우선순의 큐를 만드는 형식과 약간 비슷하다고 생각하면 된다)
```

![image](https://user-images.githubusercontent.com/76584547/125188104-94c23400-e26d-11eb-84ff-c55d62159f5a.png)



