## Mysql 최적화
----
```
  ㅇ 묵시적 형변환
  ㅇ 성능 저하를 유발하는 불필요한 서브쿼리
```

### 묵시적 형변환
-----
```
  조건절의 데이터 타입이 다를 때 우선순위가 높은 타입으로 형이 내부적으로 변환 되는 것
```
  + 정수 타입이 문자열 타입보다 우선 순위가 높다.
  + 만약 문자열과 정수값을 비교하는 쿼리가 들어오면 두 개의 칼럼 중 우선순위가 낮은 문자열은 자연스럽게 정수 타입으로 형변환되어 처리된다.

+ 어떨 경우 치명적인 묵시적 형변환이 일어날까?
```
  묵시적 형변환이 일어나는 대상이 "인덱스 필드"라면 조건절을 처리하기 위해 
  모든 데이터를 묵시적으로 형변환하기 때문에 테이블 풀스캔을 할 수밖에 없으며, 이 경우 성능이 심각하게 저하된다.
```

+ 정수형 컬럼에 문자열 조건
  + 정수형(j)이 우선순위가 높기 때문에 문자열 조건값은 묵시적으로 정수형으로 형변환되어 실행 시 큰 문제 없이 신속하게 결과를 얻는다.
```SQL
  EXPLAIN
  SELECT * FROM test
  WHERE j = '498651564'
  
  Type : ref
  Rows : 1
  ...
```

+ 문자열 컬럼에 정수형 조건
  + 문자열 컬럼(s)에 인덱스가 있으므로 일반적으로 빠른 처리를 기대하겠지만 묵시적 형변환이 발생하여 테이블 풀스캔하며 성능이 크게 저하된다.
```SQL
  EXPLAIN
  SELECT FROM test
  WHERE s = 1561321;
  
  Type : All
  Rows : 121532
```

  + 결과
  ```
    반드시 조건절에는 칼럼 타입을 맞춰서 질의하기를 권합니다.
  ```

<br/>

### 성능 저하를 유발하는 불필요한 서브쿼리
----
```
  - 오라클은 rownum 이라는 개념이 있기 때문에 데이터 결과 행에 쉽게 번호를 붙일 수 있지만 Mysql에는
    (SELECT @RNUM:=0) 같은 방식으로 번호를 매길 수 있다.
```
  + rownum 효과를 내기 위해 불필요한 서브쿼리를 사용한 예
  ```sql
    SELECT @RNUM:=@RNUM +1 AS RNUM, ROW.*
    FROM (SELECT @RNUM:=0)R,
    (
      SELECT *
      ~~~
      ~~~
    ) ROW
    LIMIT 100, 0
  ```
  
  + 결과
  ```
    - 페이지 번호를 가져오기 위해 서브쿼리에서는 테이블 간 조인을 처음부터 끝까지 수행하면서 결과값을 Temporary Table에 저장한다.
    - 결과적으로 엄청난 횟수의 조인 연산이 내부적으로 발생하는 것이다.
  ```
  
  + 서브쿼리 제거
  ```sql
    SELECT *
    ~~~
    ~~~
    LIMIT 100, 0
  ```
  
  + 결과
  ```
    해당 수정한 쿼리를 프로파일링하면 
    - 수정 전 sending data = 0.2초
    - 수정 후 sending data = 0.000009초 
    
    라는 획기적으로 줄어든 결과를 얻을 수 있다.
  ```
  
  + DB에서 무리하게 생성하는 것보다 APP서버에서 생성하는 것이 MySQL의 성능을 높이는데 유리하다 (★)

